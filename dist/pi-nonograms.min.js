/*
jsrand v1.0
https://github.com/DomenicoDeFelice/jsrand
@license
*/
if(!window.dfd){window.dfd={}}dfd.Srand=Srand=function(n){var t=function(n){if(n!==undefined){this.seed(n)}else{this.randomize()}};t._oldSrand=n;return t}(window.Srand);Srand.prototype={};Srand.seed=Srand.prototype.seed=function(n){if(n===undefined){return this._seed}this._mz=123456789;return this._mw=this._seed=n};Srand.randomize=Srand.prototype.randomize=function(){var n=this.randomIntegerIn(1,4294967295,Math.random());this.seed(n);return n};Srand.random=Srand.prototype.random=function(){if(this._seed===undefined){this.randomize()}var n=this._mz;var t=this._mw;n=(n&65535)*36969+(n>>16)&4294967295;t=(t&65535)*18e3+(t>>16)&4294967295;this._mz=n;this._mw=t;var e=((n<<16)+t&4294967295)/4294967296;return.5+e};Srand.randomIn=Srand.prototype.randomIn=function(n,t,e){if(e===undefined){e=this.random()}return n+e*(t-n)};Srand.randomIntegerIn=Srand.prototype.randomIntegerIn=function(n,t,e){if(e===undefined){e=this.random()}return n+Math.floor(e*(t-n+1))};Srand.noConflict=function(){Srand=dfd.Srand._oldSrand;return dfd.Srand};
/*
  A nonogram game written in javascript
  https://github.com/DomenicoDeFelice/Pi-Nonograms

  Play the game: http://freenonograms.altervista.org

  Copyright (c) 2013-2015 Domenico De Felice

  @license

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
!function(n){if(!n.dfd){n.dfd={}}dfd.Event=function(n){this._sender=n;this._listeners=[]};dfd.Event.prototype.attach=function n(t){this._listeners.push(t)};dfd.Event.prototype.notify=function n(t){for(var e=0,o=this._listeners.length;e<o;e++){this._listeners[e](this._sender,t)}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.CellState={UNKNOWN:"unknown",FILLED:"filled",EMPTY:"empty"};dfd.nonograms.GameMode={PLAY:"play",DRAW:"draw"}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Grid=function(n,t,e){this.width=n;this.height=t;this._defaultValue=e;this._data=new Array(n*t)};dfd.nonograms.Grid.prototype={get:function(n,t){var e;if(t===undefined){e=n}else{e=this._indexFromXY(n,t)}var o=this._data[e];return o===undefined?this._defaultValue:o},set:function(n,t,e){var o;if(arguments.length===2){o=n;e=t}else{o=this._indexFromXY(n,t)}this._data[o]=e},getRow:function(n){var t=[];for(var e=0;e<this.width;e++){t.push(this.get(e,n))}return t},getColumn:function(n){var t=[];for(var e=0;e<this.height;e++){t.push(this.get(n,e))}return t},forEach:function(n){for(var t=0;t<this._data.length;t++){var e=this._XYFromIndex(t);var o=this._data[t];if(o===undefined)o=this._defaultValue;n(e[0],e[1],o,t)}},size:function(){return this.width*this.height},clear:function(){this._data=new Array(this.width*this.height)},clone:function(){var n=new dfd.nonograms.Grid(this.width,this.height);for(var t=0;t<this._data.length;t++){n._data[t]=this._data[t]}return n},_getArray:function(){return this._data},_indexFromXY:function(n,t){return t*this.width+n},_XYFromIndex:function(n){var t=Math.floor(n/this.width);var e=n%this.width;return[e,t]}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.DefinitionCalculator=function(){};dfd.nonograms.DefinitionCalculator.prototype={calculateLineDefinition:function(n,t,e){var o=dfd.nonograms.CellState;var i=dfd.nonograms.GameMode;var s=[];var r=n.length;var d;var a;var f;var h=0;for(var l=0;l<r;l++){if(n[l]===o.FILLED){if(h===0)d=l;h++}else if(h){a=l-1;f=this._isSequenceSolved(d,a,r,t,e);s.push({length:h,solved:f});h=0}}if(h){a=r-1;f=this._isSequenceSolved(d,a,r,t,e);s.push({length:h,solved:f})}return s},_isSequenceSolved:function(n,t,e,o,i){var s=dfd.nonograms.CellState;var r=dfd.nonograms.GameMode;if(i!==r.PLAY)return false;var d=n===0||o[n-1]===s.EMPTY;var a=t===e-1||o[t+1]===s.EMPTY;if(!d||!a)return false;for(var f=n;f<=t;f++){if(o[f]!==s.FILLED){return false}}return true}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.HintProvider=function(n){this._srand=n};dfd.nonograms.HintProvider.prototype={findHint:function(n,t){var e=dfd.nonograms.CellState;var o=this._findError(n,t);if(o){return o}return this._findUnknownCell(n,t)},_findError:function(s,n){var r=dfd.nonograms.CellState;var d=null;n.forEach(function(n,t,e,o){if(d)return;var i=s.get(o);if(e===r.FILLED&&i!==r.FILLED||e===r.EMPTY&&i===r.FILLED){d={x:n,y:t,value:i}}});return d},_findUnknownCell:function(n,t){var o=dfd.nonograms.CellState;var e=n.width;var i=n.height;var s=[];t.forEach(function(n,t,e){if(e===o.UNKNOWN){s.push({x:n,y:t})}});if(s.length===0){return null}var r=this._srand.randomIntegerIn(0,s.length-1);var d=s[r];return{x:d.x,y:d.y,value:n.get(d.x,d.y)}}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.NonogramGenerator=function(n){this._srand=n};dfd.nonograms.NonogramGenerator.prototype={generate:function(n,t){var e=dfd.nonograms.CellState;var o=n.size();var i=Math.floor(o*t);if(i>o)i=o;var s;while(i){s=this._srand.randomIntegerIn(0,o-1);if(n.get(s)===e.EMPTY){n.set(s,e.FILLED);i--}}}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.DragHelper=function(){this._dragging=false};dfd.nonograms.DragHelper.prototype={start:function(n,t,e){this._x1=this._x2=n;this._y1=this._y2=t;this._guess=e;this._dragging=true},to:function(n,t){this._x2=n;this._y2=t},stop:function(){this._dragging=false},isDragging:function(){return this._dragging},iterateOverDraggedCells:function(n){var t=this._x1;var e=this._y1;var o=this._x2;var i=this._y2;var s,r,d,a,f,h;if(Math.abs(t-o)>Math.abs(e-i)){d=1;h=0;a=f=e;if(t<o){s=t;r=o}else{s=o;r=t}}else{d=0;h=1;s=r=t;if(e<i){a=e;f=i}else{a=i;f=e}}for(var l=s,u=a;l<=r&&u<=f;l+=d,u+=h){n(l,u,this._guess)}}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Model=function(n){if(!n)n={};this.width=n.width;this.height=n.height;this._definitionCalc=new dfd.nonograms.DefinitionCalculator;this._hintProvider=new dfd.nonograms.HintProvider(n.srand);this._generator=new dfd.nonograms.NonogramGenerator(n.srand);this.events={};this.events.guessChanged=new dfd.Event(this);this.events.nonogramChanged=new dfd.Event(this);this.events.nonogramSolved=new dfd.Event(this);this.events.nonogramUnsolved=new dfd.Event(this);this._setupNonogram();this.setMode(n.mode)};dfd.nonograms.Model.prototype={getCellAt:function(n,t){return this._actual.get(n,t)},getGuessAt:function(n,t){return this._guess.get(n,t)},setGuessAt:function(n,t,e){var o=dfd.nonograms.GameMode;var i;if(e===undefined){e=t;i=n;var s=this._actual._XYFromIndex(i);n=s[0];t=s[1]}var r=this.getGuessAt(n,t);this._guess.set(n,t,e);this.events.guessChanged.notify({x:n,y:t,oldGuess:r,newGuess:e});if(this._mode===o.PLAY)this._checkIfSolved()},getMode:function(){return this._mode},setMode:function(n){var t=dfd.nonograms.GameMode;var e=dfd.nonograms.CellState;if(n===this._mode)return;this._mode=n;if(n===t.DRAW){this._guess=this._actual}else{this._guess=new dfd.nonograms.Grid(this.width,this.height,e.UNKNOWN)}this._setUnsolved();this.events.nonogramChanged.notify()},isSolved:function(){return this._solved},getRowDefinition:function(n){var t=this._actual.getRow(n);var e=this._guess.getRow(n);return this._definitionCalc.calculateLineDefinition(t,e,this._mode)},getColumnDefinition:function(n){var t=this._actual.getColumn(n);var e=this._guess.getColumn(n);return this._definitionCalc.calculateLineDefinition(t,e,this._mode)},giveHint:function(){var n=dfd.nonograms.GameMode;if(this.isSolved()||this._mode!==n.PLAY)return;var t=this._hintProvider.findHint(this._actual,this._guess);if(t){this.setGuessAt(t.x,t.y,t.value)}},randomize:function(n){var t=dfd.nonograms.GameMode;this._setupNonogram();this._mode=t.PLAY;this._generator.generate(this._actual,n);this.events.nonogramChanged.notify()},resetGuesses:function(){var n=dfd.nonograms.GameMode;var t=dfd.nonograms.CellState;this._guess=new dfd.nonograms.Grid(this.width,this.height,t.UNKNOWN);if(this._mode===n.DRAW){this._actual=this._guess}this._solved=false;this.events.nonogramChanged.notify()},_setupNonogram:function(){var n=dfd.nonograms.CellState;this._actual=new dfd.nonograms.Grid(this.width,this.height,n.EMPTY);this._guess=new dfd.nonograms.Grid(this.width,this.height,n.UNKNOWN);this._setUnsolved()},_setSolved:function(){if(!this.isSolved()){this._solved=true;this.events.nonogramSolved.notify()}},_setUnsolved:function(){if(this.isSolved()){this._solved=false;this.events.nonogramUnsolved.notify()}},_checkIfSolved:function(){var i=dfd.nonograms.CellState;var s=this;var r=true;this._actual.forEach(function(n,t,e){var o=s._guess.get(n,t);if(e===i.FILLED&&o!==i.FILLED||e!==i.FILLED&&o===i.FILLED){r=false}});if(r){this._setSolved()}else{this._setUnsolved()}}}}(window);!function(n,r){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.View=function(n,t){this._model=n;this._$container=r(t);this._$nonogram=null;this._theme="classic";var e;do{e="nonogram-"+dfd.Srand.randomIntegerIn(0,1e6,Math.random())}while(r("#"+e).length);this._id=e;this.events={};this.events.mouseDownOnCell=new dfd.Event(this);this.events.mouseUp=new dfd.Event(this);this.events.mouseEntersCell=new dfd.Event(this);this.events.mouseLeavesCell=new dfd.Event(this)};dfd.nonograms.View.prototype={show:function(){this.rebuildNonogram()},setSolved:function(){this._$nonogram.removeClass("nonogram_playing").addClass("nonogram_solved")},setUnsolved:function(){this._$nonogram.removeClass("nonogram_solved").addClass("nonogram_playing")},setTheme:function(n){if(this._$nonogram){this._$nonogram.removeClass(this._theme).addClass(n)}this._theme=n},highlightColumn:function(n){this._$container.find(".nonogram_column_"+n+"_cell").addClass("nonogram_hovered_column");this._$container.find("#"+this._idOfColumnDefinition(n)).addClass("nonogram_hovered_column")},unhighlightColumn:function(n){this._$container.find(".nonogram_column_"+n+"_cell").removeClass("nonogram_hovered_column");this._$container.find("#"+this._idOfColumnDefinition(n)).removeClass("nonogram_hovered_column")},setGuessAt:function(n,t,e){var o=r("#"+this._idOfCell(n,t));var i=o.data().guess;o.removeClass("nonogram_correct_guess").removeClass(this._guessToCSSClass(i)).addClass(this._guessToCSSClass(e)).data({guess:e});if(this._model.getCellAt(n,t)===e){o.addClass("nonogram_correct_guess")}r("#"+this._idOfRowDefinition(t)).html(this._rowDefinitionToHTML(this._model.getRowDefinition(t)));r("#"+this._idOfColumnDefinition(n)).html(this._columnDefinitionToHTML(this._model.getColumnDefinition(n)))},rebuildNonogram:function(){var n=this._model.width,t=this._model.height;var e,o,i;var s=this._$nonogram=r("<table>").attr("id",this._id).addClass("nonogram").addClass(this._theme);if(this._model.isSolved()){s.addClass("nonogram_solved")}else{s.addClass("nonogram_playing")}i=r("<tr>").addClass("nonogram_row");r("<td>").addClass("nonogram_top_left_cell").appendTo(i);for(e=0;e<n;e++){if(e&&e%5===0){r("<td>").addClass("nonogram_separation_column").appendTo(i)}r("<td>").attr("id",this._idOfColumnDefinition(e)).addClass("nonogram_definition nonogram_column_definition").html(this._columnDefinitionToHTML(this._model.getColumnDefinition(e))).appendTo(i)}i.appendTo(s);for(o=0;o<t;o++){if(o&&o%5===0){r("<tr>").addClass("nonogram_separation_row").append(r('<td colspan="'+(n+n-1)+'">')).appendTo(s)}i=r("<tr>").addClass("nonogram_row");r("<td>").attr("id",this._idOfRowDefinition(o)).addClass("nonogram_definition nonogram_row_definition").html(this._rowDefinitionToHTML(this._model.getRowDefinition(o))).appendTo(i);for(e=0;e<n;e++){if(e&&e%5===0){r("<td>").addClass("nonogram_separation_column").appendTo(i)}r("<td>").attr("id",this._idOfCell(e,o)).addClass(this._CSSClassesForCell(e,o)).data({x:e,y:o,guess:this._model.getGuessAt(e,o)}).appendTo(i)}i.appendTo(s)}this._setupEventHandlers(s);this._$container.finish().hide().empty().append(s).show()},_setupEventHandlers:function(n){var e=this;n.on("mousedown","td",function(n){if(n.which!==1)return;n.preventDefault();var t=r(n.target).data();e.events.mouseDownOnCell.notify(t)});var t=function(){if(!r.contains(document,n[0])){r(document).unbind("mouseup",t)}else{e.events.mouseUp.notify()}};r(document).on("mouseup",t);n.on("mouseover","td",function(n){n.preventDefault();var t=r(n.target).data();e.events.mouseEntersCell.notify(t)});n.on("mouseout","td",function(n){n.preventDefault();var t=r(n.target).data();e.events.mouseLeavesCell.notify(t)})},_idOfCell:function(n,t){return this._id+"_x_"+n+"_y_"+t},_idOfRowDefinition:function(n){return this._id+"_row_"+n+"_definition"},_idOfColumnDefinition:function(n){return this._id+"_column_"+n+"_definition"},_rowDefinitionToHTML:function(n){var t="<nobr>";var e=n.length;for(var o=0;o<e;o++){if(o)t+="&nbsp;";t+='<span class="nonogram_sequence';if(n[o].solved){t+=" nonogram_solved_sequence"}t+='">'+n[o].length+"</span>"}t+="</nobr>";return t},_columnDefinitionToHTML:function(n){var t="";var e=n.length;for(var o=0;o<e;o++){if(o)t+="<br>";t+='<nobr><span class="nonogram_sequence';if(n[o].solved){t+=" nonogram_solved_sequence"}t+='">'+n[o].length+"</span></nobr>"}return t},_CSSClassesForCell:function(n,t){var e=this._model.getGuessAt(n,t);var o=this._model.getCellAt(n,t);var i=[];i.push("nonogram_cell");i.push("nonogram_column_"+n+"_cell");i.push(this._guessToCSSClass(e));if(e===o){i.push("nonogram_correct_guess")}return i.join(" ")},_guessToCSSClass:function(n){var t=dfd.nonograms.CellState;var e=n;if(n===t.UNKNOWN||n===t.FILLED||n===t.EMPTY){e=n}return"nonogram_"+e+"_cell"}}}(window,jQuery);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Controller=function(e,o){this._dragHelper=new dfd.nonograms.DragHelper;this._model=e;this._view=o;var i=this;e.events.nonogramChanged.attach(function(){o.rebuildNonogram()});e.events.guessChanged.attach(function(n,t){o.setGuessAt(t.x,t.y,t.newGuess)});e.events.nonogramSolved.attach(function(){o.setSolved()});e.events.nonogramUnsolved.attach(function(){o.setUnsolved()});o.events.mouseDownOnCell.attach(function(n,t){i._dragHelper.start(t.x,t.y,i._nextGuess(e.getGuessAt(t.x,t.y)));i._previewDragging()});o.events.mouseUp.attach(function(){if(!i._dragHelper.isDragging())return;i._dragHelper.stop();i._cancelDraggingPreview();i._applyDragging()});o.events.mouseEntersCell.attach(function(n,t){n.highlightColumn(t.x);if(!i._dragHelper.isDragging())return;i._cancelDraggingPreview();i._dragHelper.to(t.x,t.y);i._previewDragging()});o.events.mouseLeavesCell.attach(function(n,t){n.unhighlightColumn(t.x)})};dfd.nonograms.Controller.prototype={_nextGuess:function(n){var t=dfd.nonograms.CellState;if(n===t.UNKNOWN){return t.FILLED}else if(n===t.FILLED){return t.EMPTY}return t.UNKNOWN},_previewDragging:function(){var o=this._view;this._dragHelper.iterateOverDraggedCells(function(n,t,e){o.setGuessAt(n,t,e)})},_applyDragging:function(){var o=this._model;this._dragHelper.iterateOverDraggedCells(function(n,t,e){o.setGuessAt(n,t,e)})},_cancelDraggingPreview:function(){var o=this._model;var i=this._view;this._dragHelper.iterateOverDraggedCells(function(n,t,e){i.setGuessAt(n,t,o.getGuessAt(n,t))})}}}(window);!function(n){if(!n.dfd){n.dfd={}}if(!dfd.nonograms){dfd.nonograms={}}dfd.nonograms.Nonogram=function(n,t){var e,o,i;var s=dfd.nonograms.Nonogram.options;t=t||{};for(var r in s){t[r]=t[r]||s[r]}e=new dfd.nonograms.Model({width:t.width,height:t.height,srand:t.srand,mode:t.mode});e.events.nonogramSolved.attach(t.onSolved);o=new dfd.nonograms.View(e,n);o.setTheme(t.theme);i=new dfd.nonograms.Controller(e,o);this._model=e;this._view=o;this._controller=i;this._container=n;this._opts=t};dfd.nonograms.Nonogram.options={width:10,height:10,mode:dfd.nonograms.GameMode.PLAY,theme:"classic",srand:dfd.Srand,onSolved:function(){alert("Congratulations! Nonogram solved!")}};dfd.nonograms.Nonogram.prototype={show:function(){this._view.show()},randomize:function(n){var t=.6;if(n&&n.density){t=n.density}this._model.randomize(t)},giveHint:function(){this._model.giveHint()},startOver:function(){this._model.resetGuesses()},setTheme:function(n){this._opts.theme=n;this._view.setTheme(n)},getMode:function(){return this._model.getMode()},setMode:function(n){this._model.setMode(n)},showGameState:function(){}}}(window);